import*as t from"@wordpress/interactivity";var e={d:(t,o)=>{for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};const o=(n={getConfig:()=>t.getConfig,getContext:()=>t.getContext,getElement:()=>t.getElement,store:()=>t.store,withScope:()=>t.withScope},a={},e.d(a,n),a);var n,a;const{apiFetch:c}=window.wp;!function(){const{actions:t,callbacks:e}=(0,o.store)("activitypub/reactions",{actions:{openModal(t){const n=(0,o.getContext)();n.modal.isOpen=!0,n.modal.isCompact?setTimeout(e.positionModal,0):setTimeout((()=>{const t=document.getElementById(n.blockId);if(t){const o=t.querySelector(".activitypub-modal__frame");o&&e.trapFocus(o)}}),50),"function"==typeof e.onModalOpen&&e.onModalOpen(t)},closeModal(t){const n=(0,o.getContext)();n.modal.isOpen=!1;const a=(0,o.getElement)();if("actions.toggleModal"===a.ref.dataset["wpOn-Click"])a.ref.focus();else{const t=document.getElementById(n.blockId);if(t){const e=t.querySelector('[data-wp-on--click="actions.toggleModal"], [data-wp-on-async--click="actions.toggleModal"]');e&&e.focus()}}"function"==typeof e.onModalClose&&e.onModalClose(t)},toggleModal(e){const{modal:n}=(0,o.getContext)();n.isOpen?t.closeModal(e):t.openModal(e)}},callbacks:{_abortController:null,handleModalEffects(){const{modal:t}=(0,o.getContext)();if(t.isOpen&&!t.isCompact?document.body.classList.add("modal-open"):document.body.classList.remove("modal-open"),e._abortController&&(e._abortController.abort(),e._abortController=null),t.isOpen){e._abortController=new AbortController;const{signal:t}=e._abortController;document.addEventListener("keydown",e.documentKeydown,{signal:t}),document.addEventListener("click",e.documentClick,{signal:t})}},documentKeydown(e){const{modal:n}=(0,o.getContext)();n.isOpen&&"Escape"===e.key&&t.closeModal()},documentClick(e){const{blockId:n,modal:a}=(0,o.getContext)();if(!a.isOpen)return;const c=document.getElementById(n);if(!c)return;const l=c.querySelector('.wp-element-button[data-wp-on--click="actions.toggleModal"]');if(l&&(l===e.target||l.contains(e.target)))return;const s=c.querySelector(".activitypub-modal__frame");s&&!s.contains(e.target)&&t.closeModal()},positionModal(){const{blockId:t}=(0,o.getContext)(),e=document.getElementById(t);if(!e)return;const n=e.querySelector(".activitypub-modal__overlay");if(!n)return;n.style.top="",n.style.left="",n.style.right="",n.style.bottom="";const a=(0,o.getElement)().ref.getBoundingClientRect(),c=window.innerWidth,l=e.getBoundingClientRect();let s={top:a.bottom-l.top+8+"px",left:a.left-l.left-2+"px"};c-a.right<250&&(s.left="auto",s.right=l.right-a.right+"px"),Object.assign(n.style,s)},trapFocus(t){const e=t.querySelectorAll('a[href]:not([disabled]), button:not([disabled]), textarea:not([disabled]), input[type="text"]:not([disabled]):not([readonly]), input[type="radio"]:not([disabled]), input[type="checkbox"]:not([disabled]), select:not([disabled])'),o=e[0],n=e[e.length-1];o&&o.classList.contains("activitypub-modal__close")&&e.length>1?e[1].focus():o.focus(),t.addEventListener("keydown",(function(t){"Tab"!==t.key&&9!==t.keyCode||(t.shiftKey?document.activeElement===o&&(n.focus(),t.preventDefault()):document.activeElement===n&&(o.focus(),t.preventDefault()))}))}}})}();const{callbacks:l,state:s}=(0,o.store)("activitypub/reactions",{actions:{async fetchReactions(){const t=(0,o.getContext)(),{namespace:e}=(0,o.getConfig)();if(t.postId)try{t.reactions=await c({path:`/${e}/posts/${t.postId}/reactions`})}catch(t){console.error("Error fetching reactions:",t)}}},callbacks:{initReactions(){const t=new ResizeObserver((0,o.withScope)(l.calculateVisibleAvatars));return(0,o.getElement)().ref.querySelectorAll(".reaction-group").forEach((e=>{t.observe(e)})),()=>{t.disconnect()}},calculateVisibleAvatars(){const{postId:t}=(0,o.getContext)();(s.reactions&&s.reactions[t]?Object.keys(s.reactions[t]):[]).forEach((e=>{s.reactions?.[t][e]?.items?.length&&(0,o.getElement)().ref.querySelectorAll(`.reaction-group[data-reaction-type="${e}"]`).forEach((o=>{const n=o.querySelector(".reaction-label").offsetWidth||0,a=o.offsetWidth-n-12;let c=1;a>32&&(c+=Math.floor((a-32)/22));const l=s.reactions[t][e].items,i=Math.min(c,l.length),r=o.querySelector(".reaction-avatars");r&&r.querySelectorAll("li").forEach(((t,e)=>{e<i?t.removeAttribute("hidden"):t.setAttribute("hidden","hidden")}))}))}))},setDefaultAvatar(t){t.target.src=(0,o.getConfig)().defaultAvatarUrl},onModalOpen(){const t=(0,o.getContext)(),e=(0,o.getElement)().ref.dataset.reactionType;t.modal.items=s.reactions[t.postId][e].items}}});