(()=>{"use strict";var e,t={20:(e,t,a)=>{var r=a(609),l=Symbol.for("react.element"),o=(Symbol.for("react.fragment"),Object.prototype.hasOwnProperty),n=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};t.jsx=function(e,t,a){var r,i={},c=null,p=null;for(r in void 0!==a&&(c=""+a),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(p=t.ref),t)o.call(t,r)&&!s.hasOwnProperty(r)&&(i[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===i[r]&&(i[r]=t[r]);return{$$typeof:l,type:e,key:c,ref:p,props:i,_owner:n.current}}},609:e=>{e.exports=window.React},751:(e,t,a)=>{const r=window.wp.blocks,l=window.wp.primitives;var o=a(848);const n=(0,o.jsx)(l.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,o.jsx)(l.Path,{d:"M15.5 9.5a1 1 0 100-2 1 1 0 000 2zm0 1.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5zm-2.25 6v-2a2.75 2.75 0 00-2.75-2.75h-4A2.75 2.75 0 003.75 15v2h1.5v-2c0-.69.56-1.25 1.25-1.25h4c.69 0 1.25.56 1.25 1.25v2h1.5zm7-2v2h-1.5v-2c0-.69-.56-1.25-1.25-1.25H15v-1.5h2.5A2.75 2.75 0 0120.25 15zM9.5 8.5a1 1 0 11-2 0 1 1 0 012 0zm1.5 0a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z",fillRule:"evenodd"})}),s=[{attributes:{title:{type:"string",default:"Fediverse Followers"},selectedUser:{type:"string",default:"blog"},per_page:{type:"number",default:10},order:{type:"string",default:"desc",enum:["asc","desc"]}},supports:{html:!1},isEligible:({title:e})=>!!e,migrate:({title:e,...t})=>[t,[(0,r.createBlock)("core/heading",{content:e,level:3})]]}];var i=a(609);const c=window.wp.apiFetch;var p=a.n(c);const u=window.wp.components,d=window.wp.blockEditor,v=window.wp.coreData,m=window.wp.data,f=window.wp.element,w=window.wp.url,g=window.wp.i18n;function h(){return window._activityPubOptions||{}}function b({name:e}){const{enabled:t}=h(),a=t?.blog?"":(0,g.__)("It will be empty in other non-author contexts.","activitypub"),r=(0,g.sprintf)(/* translators: %1$s: block name, %2$s: extra information for non-author context */ /* translators: %1$s: block name, %2$s: extra information for non-author context */
(0,g.__)("This <strong>%1$s</strong> block will adapt to the page it is on, displaying the user profile associated with a post author (in a loop) or a user archive. %2$s","activitypub"),e,a).trim();return(0,i.createElement)(u.Card,null,(0,i.createElement)(u.CardBody,null,(0,f.createInterpolateElement)(r,{strong:(0,i.createElement)("strong",null)})))}function _({selectedUser:e,per_page:t,order:a,page:r,setPage:l,followerData:o=!1}){const n="blog"===e?0:e,[s,c]=(0,f.useState)([]),[u,d]=(0,f.useState)(0),[v,m]=(0,f.useState)(0),[b,_]=(0,f.useState)(1),x=r||b,k=l||_,N=(e,a)=>{c(e),m(a),d(Math.ceil(a/t))};return(0,f.useEffect)((()=>{if(o&&1===x)return N(o.followers,o.total);const e=function(e,t,a,r){const{namespace:l}=h(),o=`/${l}/actors/${e}/followers`,n={per_page:t,order:a,page:r,context:"full"};return(0,w.addQueryArgs)(o,n)}(n,t,a,x);p()({path:e}).then((({orderedItems:e,totalItems:t})=>N(e,t))).catch((()=>N([],0)))}),[n,t,a,x,o]),(0,i.createElement)("div",{className:"followers-container"},s.length?(0,i.createElement)("ul",{className:"followers-list"},s.map((e=>(0,i.createElement)("li",{key:e.url,className:"follower-item"},(0,i.createElement)(E,{...e}))))):(0,i.createElement)("p",{className:"followers-placeholder"},(0,g.__)("No followers found.","activitypub")),(0,i.createElement)(y,{page:x,pages:u,setPage:k}))}function y({page:e,pages:t,setPage:a}){if(t<=1)return null;const r=e<=1,l=e>=t;return(0,i.createElement)("nav",{className:"followers-pagination",role:"navigation"},(0,i.createElement)("h1",{className:"screen-reader-text"},(0,g.__)("Follower navigation","activitypub")),(0,i.createElement)("a",{className:"pagination-previous","aria-disabled":r,"aria-label":(0,g.__)("Previous page","activitypub"),onClick:t=>{t.preventDefault(),a(e-1)}},(0,g.__)("Previous","activitypub")),(0,i.createElement)("div",{className:"pagination-info"},`${e} / ${t}`),(0,i.createElement)("a",{className:"pagination-next","aria-disabled":l,"aria-label":(0,g.__)("Next page","activitypub"),onClick:t=>{t.preventDefault(),a(e+1)}},(0,g.__)("Next","activitypub")))}function E({name:e,icon:t,url:a,preferredUsername:r}){const l=`@${r}`,{defaultAvatarUrl:o}=h(),n=t?.url||o;return(0,i.createElement)("a",{className:"follower-link",href:a,title:l,onClick:e=>e.preventDefault()},(0,i.createElement)("img",{width:"48",height:"48",src:n,className:"follower-avatar",alt:e,onError:e=>{e.target.src=o}}),(0,i.createElement)("div",{className:"follower-info"},(0,i.createElement)("span",{className:"follower-name"},e),(0,i.createElement)("span",{className:"follower-username"},l)),(0,i.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"24",height:"24",className:"external-link-icon","aria-hidden":"true",focusable:"false",fill:"currentColor"},(0,i.createElement)("path",{d:"M18.2 17c0 .7-.6 1.2-1.2 1.2H7c-.7 0-1.2-.6-1.2-1.2V7c0-.7.6-1.2 1.2-1.2h3.2V4.2H7C5.5 4.2 4.2 5.5 4.2 7v10c0 1.5 1.2 2.8 2.8 2.8h10c1.5 0 2.8-1.2 2.8-2.8v-3.6h-1.5V17zM14.9 3v1.5h3.7l-6.4 6.4 1.1 1.1 6.4-6.4v3.7h1.5V3h-6.3z"})))}const x=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","name":"activitypub/followers","apiVersion":3,"version":"2.0.1","title":"Fediverse Followers","category":"widgets","description":"Display your followers from the Fediverse on your website.","textdomain":"activitypub","icon":"groups","supports":{"html":false,"interactivity":true},"attributes":{"selectedUser":{"type":"string","default":"blog"},"per_page":{"type":"number","default":10},"order":{"type":"string","default":"desc","enum":["asc","desc"]}},"usesContext":["postType","postId"],"styles":[{"name":"default","label":"Default","isDefault":true},{"name":"card","label":"Card"},{"name":"compact","label":"Compact"}],"editorScript":"file:./index.js","editorStyle":"file:./index.css","viewScriptModule":"file:./view.js","viewScript":"wp-api-fetch","style":["file:./style-index.css"],"render":"file:./render.php"}');(0,r.registerBlockType)(x,{deprecated:s,edit:function({attributes:e,setAttributes:t,context:{postType:a,postId:r}}){const{className:l="",order:o,per_page:n,selectedUser:s}=e,c=(0,d.useBlockProps)(),[w,y]=(0,f.useState)(1),E=[{label:(0,g.__)("New to old","activitypub"),value:"desc"},{label:(0,g.__)("Old to new","activitypub"),value:"asc"}],x=function({withInherit:e=!1}){const{enabled:t,namespace:a}=h(),[r,l]=(0,f.useState)(!1),{fetchedUsers:o,isLoadingUsers:n}=(0,m.useSelect)((e=>{const{getUsers:a,getIsResolving:r}=e("core");return{fetchedUsers:t?.users?a({capabilities:"activitypub"}):null,isLoadingUsers:!!t?.users&&r("getUsers",[{capabilities:"activitypub"}])}}),[]),s=(0,m.useSelect)((e=>o||n?null:e("core").getCurrentUser()),[o,n]);(0,f.useEffect)((()=>{o||n||!s||p()({path:`/${a}/actors/${s.id}`,method:"HEAD",headers:{Accept:"application/activity+json"},parse:!1}).then((()=>l(!0))).catch((()=>l(!1)))}),[o,n,s]);const i=o||(s&&r?[{id:s.id,name:s.name}]:[]);return(0,f.useMemo)((()=>{if(!i.length)return[];const a=[];return t?.blog&&o&&a.push({label:(0,g.__)("Blog","activitypub"),value:"blog"}),e&&t?.users&&o&&a.push({label:(0,g.__)("Dynamic User","activitypub"),value:"inherit"}),i.reduce(((e,t)=>(e.push({label:t.name,value:`${t.id}`}),e)),a)}),[i])}({withInherit:!0}),k=e=>a=>{y(1),t({[e]:a})},N=(0,m.useSelect)((e=>{const{getEditedEntityRecord:t}=e(v.store),l=t("postType",a,r)?.author;return null!=l?l:null}),[a,r]);(0,f.useEffect)((()=>{x.length&&(x.find((({value:e})=>e===s))||t({selectedUser:x[0].value}))}),[s,x]);const S=[["core/heading",{level:3,placeholder:(0,g.__)("Fediverse Followers","activitypub"),content:(0,g.__)("Fediverse Followers","activitypub")}]];return(0,i.createElement)("div",{...c},(0,i.createElement)(d.InspectorControls,{key:"setting"},(0,i.createElement)(u.PanelBody,{title:(0,g.__)("Followers Options","activitypub")},x.length>1&&(0,i.createElement)(u.SelectControl,{label:(0,g.__)("Select User","activitypub"),value:s,options:x,onChange:k("selectedUser"),__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0}),(0,i.createElement)(u.SelectControl,{label:(0,g.__)("Sort","activitypub"),value:o,options:E,onChange:k("order"),__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0}),(0,i.createElement)(u.RangeControl,{label:(0,g.__)("Number of Followers","activitypub"),value:n,onChange:k("per_page"),min:1,max:10,__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0}))),(0,i.createElement)("div",{className:"wp-block-activitypub-followers "+l},(0,i.createElement)(d.InnerBlocks,{template:S,allowedBlocks:["core/heading"],templateLock:"all",renderAppender:!1}),"inherit"===s?N?(0,i.createElement)(_,{...e,page:w,setPage:y,selectedUser:N}):(0,i.createElement)(b,{name:(0,g.__)("Followers","activitypub")}):(0,i.createElement)(_,{...e,page:w,setPage:y})))},save:function(){const e=d.useBlockProps.save(),t=d.useInnerBlocksProps.save(e);return(0,i.createElement)("div",{...t})},icon:n})},848:(e,t,a)=>{e.exports=a(20)}},a={};function r(e){var l=a[e];if(void 0!==l)return l.exports;var o=a[e]={exports:{}};return t[e](o,o.exports,r),o.exports}r.m=t,e=[],r.O=(t,a,l,o)=>{if(!a){var n=1/0;for(p=0;p<e.length;p++){for(var[a,l,o]=e[p],s=!0,i=0;i<a.length;i++)(!1&o||n>=o)&&Object.keys(r.O).every((e=>r.O[e](a[i])))?a.splice(i--,1):(s=!1,o<n&&(n=o));if(s){e.splice(p--,1);var c=l();void 0!==c&&(t=c)}}return t}o=o||0;for(var p=e.length;p>0&&e[p-1][2]>o;p--)e[p]=e[p-1];e[p]=[a,l,o]},r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var a in t)r.o(t,a)&&!r.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={149:0,17:0};r.O.j=t=>0===e[t];var t=(t,a)=>{var l,o,[n,s,i]=a,c=0;if(n.some((t=>0!==e[t]))){for(l in s)r.o(s,l)&&(r.m[l]=s[l]);if(i)var p=i(r)}for(t&&t(a);c<n.length;c++)o=n[c],r.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return r.O(p)},a=globalThis.webpackChunkwordpress_activitypub=globalThis.webpackChunkwordpress_activitypub||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))})();var l=r.O(void 0,[17],(()=>r(751)));l=r.O(l)})();