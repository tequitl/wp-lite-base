import*as t from"@wordpress/interactivity";var e={d:(t,o)=>{for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};const o=(r={getConfig:()=>t.getConfig,getContext:()=>t.getContext,getElement:()=>t.getElement,store:()=>t.store},l={},e.d(l,r),l),n={computedStyles:null,variables:{}};var r,l;function c(t){if("undefined"==typeof window||!window.getComputedStyle)return!1;if(n.variables.hasOwnProperty(t))return n.variables[t];n.computedStyles||(n.computedStyles=window.getComputedStyle(document.documentElement));const e=n.computedStyles.getPropertyValue(t).trim();return n.variables[t]=""!==e,n.variables[t]}function i(t){if("string"!=typeof t)return null;if(t.match(/^#/))return t.substring(0,7);const[,,e]=t.split("|"),o=`--wp--preset--color--${e}`;return c(o)?`var(${o})`:null}function a(t,e,o=null,n=""){return o?`${t}${n} { ${e}: ${o}; }\n`:""}function s(t,e,o,n){return a(t,"background-color",e)+a(t,"color",o)+a(t,"background-color",n,":hover")+a(t,"background-color",n,":focus")}const{apiFetch:d}=window.wp;!function(){const{actions:t,callbacks:e}=(0,o.store)("activitypub/follow-me",{actions:{openModal(t){const n=(0,o.getContext)();n.modal.isOpen=!0,n.modal.isCompact?setTimeout(e.positionModal,0):setTimeout((()=>{const t=document.getElementById(n.blockId);if(t){const o=t.querySelector(".activitypub-modal__frame");o&&e.trapFocus(o)}}),50),"function"==typeof e.onModalOpen&&e.onModalOpen(t)},closeModal(t){const n=(0,o.getContext)();n.modal.isOpen=!1;const r=(0,o.getElement)();if("actions.toggleModal"===r.ref.dataset["wpOn-Click"])r.ref.focus();else{const t=document.getElementById(n.blockId);if(t){const e=t.querySelector('[data-wp-on--click="actions.toggleModal"], [data-wp-on-async--click="actions.toggleModal"]');e&&e.focus()}}"function"==typeof e.onModalClose&&e.onModalClose(t)},toggleModal(e){const{modal:n}=(0,o.getContext)();n.isOpen?t.closeModal(e):t.openModal(e)}},callbacks:{_abortController:null,handleModalEffects(){const{modal:t}=(0,o.getContext)();if(t.isOpen&&!t.isCompact?document.body.classList.add("modal-open"):document.body.classList.remove("modal-open"),e._abortController&&(e._abortController.abort(),e._abortController=null),t.isOpen){e._abortController=new AbortController;const{signal:t}=e._abortController;document.addEventListener("keydown",e.documentKeydown,{signal:t}),document.addEventListener("click",e.documentClick,{signal:t})}},documentKeydown(e){const{modal:n}=(0,o.getContext)();n.isOpen&&"Escape"===e.key&&t.closeModal()},documentClick(e){const{blockId:n,modal:r}=(0,o.getContext)();if(!r.isOpen)return;const l=document.getElementById(n);if(!l)return;const c=l.querySelector('.wp-element-button[data-wp-on--click="actions.toggleModal"]');if(c&&(c===e.target||c.contains(e.target)))return;const i=l.querySelector(".activitypub-modal__frame");i&&!i.contains(e.target)&&t.closeModal()},positionModal(){const{blockId:t}=(0,o.getContext)(),e=document.getElementById(t);if(!e)return;const n=e.querySelector(".activitypub-modal__overlay");if(!n)return;n.style.top="",n.style.left="",n.style.right="",n.style.bottom="";const r=(0,o.getElement)().ref.getBoundingClientRect(),l=window.innerWidth,c=e.getBoundingClientRect();let i={top:r.bottom-c.top+8+"px",left:r.left-c.left-2+"px"};l-r.right<250&&(i.left="auto",i.right=c.right-r.right+"px"),Object.assign(n.style,i)},trapFocus(t){const e=t.querySelectorAll('a[href]:not([disabled]), button:not([disabled]), textarea:not([disabled]), input[type="text"]:not([disabled]):not([readonly]), input[type="radio"]:not([disabled]), input[type="checkbox"]:not([disabled]), select:not([disabled])'),o=e[0],n=e[e.length-1];o&&o.classList.contains("activitypub-modal__close")&&e.length>1?e[1].focus():o.focus(),t.addEventListener("keydown",(function(t){"Tab"!==t.key&&9!==t.keyCode||(t.shiftKey?document.activeElement===o&&(n.focus(),t.preventDefault()):document.activeElement===n&&(o.focus(),t.preventDefault()))}))}}})}();const{actions:u,callbacks:p}=(0,o.store)("activitypub/follow-me",{actions:{copyToClipboard(){const t=(0,o.getContext)(),{i18n:e}=(0,o.getConfig)();navigator.clipboard.writeText(t.webfinger).then((()=>{t.copyButtonText=e.copied,setTimeout((()=>{t.copyButtonText=e.copy}),1e3)}),(t=>{console.error("Could not copy text: ",t)}))},updateRemoteProfile(t){const e=(0,o.getContext)();e.remoteProfile=t.target.value,e.isError=!1,e.errorMessage=""},onKeydown(t){"A"!==(0,o.getElement)().ref.tagName||"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),u.toggleModal(t))},handleKeyDown(t){"Enter"===t.key&&(t.preventDefault(),u.submitRemoteProfile())},submitRemoteProfile:function*(){const t=(0,o.getContext)(),{namespace:e,i18n:n}=(0,o.getConfig)(),r=t.remoteProfile.trim();if(!r)return t.isError=!0,void(t.errorMessage=n.emptyProfileError);if(!p.isHandle(r))return t.isError=!0,void(t.errorMessage=n.invalidProfileError);t.isLoading=!0,t.isError=!1;const l=`/${e}/actors/${t.userId}/remote-follow?resource=${encodeURIComponent(r)}`;try{const e=yield d({path:l});t.isLoading=!1,window.open(e.url,"_blank"),u.closeModal(new Event("click"))}catch(e){console.error("Error submitting profile:",e),t.isLoading=!1,t.isError=!0,t.errorMessage=e.message||n.genericError}}},callbacks:{initButtonStyles:()=>{const{buttonStyle:t,backgroundColor:e,blockId:n}=(0,o.getContext)();if(n&&t){const o=document.createElement("style"),l=`#${n}`;o.textContent=function(t,e,o){const n=`${t} .wp-block-button__link`,r=function(t){if("string"==typeof t){const e=`--wp--preset--color--${t}`;return c(e)?`var(${e})`:null}return t?.color?.background||null}(o)||e?.color?.background;return s(n,i(e?.elements?.link?.color?.text),r,i(e?.elements?.link?.[":hover"]?.color?.text))}(l,t,e),document.head.appendChild(o);const a=document.createElement("style");a.textContent=(r=t,s(".activitypub-dialog__button-group .wp-block-button",i(r?.elements?.link?.color?.text)||"#111","#fff",i(r?.elements?.link?.[":hover"]?.color?.text)||"#333")),document.head.appendChild(a)}var r},isHandle(t){const e=t.replace(/^@/,"").split("@");return 2===e.length&&p.isUrl(`https://${e[1]}`)},isUrl(t){try{return new URL(t),!0}catch(t){return!1}},onModalClose(){(0,o.getContext)().isError=!1}}});